
-- To test table, procedure, function
CREATE TABLE babel_object_id_t1 (a int);
GO

CREATE PROCEDURE babel_object_id_proc1 AS SELECT 1;
GO

CREATE FUNCTION babel_object_id_func1() returns int BEGIN RETURN 1; END
GO

CREATE VIEW babel_object_id_v1 AS SELECT 1;
GO

-- To test schema and object name containing spaces and dots
CREATE TABLE [babel_object_id_t2 .with .dot_an_spaces] (a int);
GO

CREATE SCHEMA [babel_object_id_schema .with .dot_and_spaces]
GO

CREATE TABLE [babel_object_id_schema .with .dot_and_spaces]."babel_object_id_t3 .with .dot_and_spaces" (a int);
GO

-- To test lookup in different database
CREATE DATABASE babel_object_id_db;
GO

USE babel_object_id_db;
GO

CREATE TABLE babel_object_id_t1 (a int);
GO

USE master;
GO

-- To test temp object
CREATE TABLE #babel_object_id_temp_t1 (a int);
GO

-- test table, procedure, function, views
SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_proc1'))
GO
~~START~~
varchar
babel_object_id_proc1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_func1'))
GO
~~START~~
varchar
babel_object_id_func1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_v1'))
GO
~~START~~
varchar
babel_object_id_v1
~~END~~


-- We can also specify object_type as parameter
SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_t1', 'U'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_proc1', 'P'))
GO
~~START~~
varchar
babel_object_id_proc1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_func1', 'FN'))
GO
~~START~~
varchar
babel_object_id_func1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_v1', 'V'))
GO
~~START~~
varchar
babel_object_id_v1
~~END~~


-- temp tables
SELECT OBJECT_NAME(OBJECT_ID('#babel_object_id_temp_t1', 'U'))
GO
~~START~~
varchar
#babel_object_id_temp_t1
~~END~~


-- traling spaces
SELECT OBJECT_NAME(OBJECT_ID('babel_object_id_t1    '))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


-- Case insensitive
SELECT OBJECT_NAME(OBJECT_ID('Babel_Object_ID_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


-- leading spaces should fail
SELECT (CASE WHEN OBJECT_NAME(OBJECT_ID('   babel_object_id_t1')) = 'babel_object_id_t1' THEN 'true' ELSE 'false' END) result;
GO
~~START~~
text
false
~~END~~


-- testing different scenarios of 3-part name 
SELECT OBJECT_NAME(OBJECT_ID('dbo.babel_object_id_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('..babel_object_id_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('master.dbo.babel_object_id_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('[master]."dbo".[babel_object_id_t1]'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('"master".[dbo]."babel_object_id_t1"'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('master..babel_object_id_t1'))
GO
~~START~~
varchar
babel_object_id_t1
~~END~~


-- schema and object name containing spaces and dots
SELECT OBJECT_NAME(OBJECT_ID('[babel_object_id_t2 .with .dot_an_spaces]'));
GO
~~START~~
varchar
babel_object_id_t2 .with .dot_an_spaces
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('master.."babel_object_id_t2 .with .dot_an_spaces"'));
GO
~~START~~
varchar
babel_object_id_t2 .with .dot_an_spaces
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('[babel_object_id_schema .with .dot_and_spaces]."babel_object_id_t3 .with .dot_and_spaces"'));
GO
~~START~~
varchar
babel_object_id_t3 .with .dot_and_spaces
~~END~~


-- Can only do lookup in current database, following should fail
SELECT OBJECT_ID('babel_object_id_db..babel_object_id_t1')
GO
~~START~~
int
~~ERROR (Code: 33557097)~~

~~ERROR (Message: Can only do lookup in current database.)~~


SELECT OBJECT_ID('non_existing_db..babel_object_id_t1')
GO
~~START~~
int
~~ERROR (Code: 33557097)~~

~~ERROR (Message: Can only do lookup in current database.)~~


-- temp object
SELECT OBJECT_NAME(OBJECT_ID('#babel_object_id_temp_t1'))
GO
~~START~~
varchar
#babel_object_id_temp_t1
~~END~~


SELECT OBJECT_NAME(OBJECT_ID('tempdb..#babel_object_id_temp_t1'))
GO
~~START~~
varchar
#babel_object_id_temp_t1
~~END~~


DROP TABLE #babel_object_id_temp_t1;
GO

USE babel_object_id_db;
GO

DROP TABLE babel_object_id_t1;
GO

USE master;
GO

DROP DATABASE babel_object_id_db;
GO

DROP TABLE [babel_object_id_schema .with .dot_and_spaces]."babel_object_id_t3 .with .dot_and_spaces";
GO

DROP SCHEMA [babel_object_id_schema .with .dot_and_spaces]
GO

DROP TABLE [babel_object_id_t2 .with .dot_an_spaces]
GO

DROP FUNCTION babel_object_id_func1
GO

DROP PROCEDURE babel_object_id_proc1
GO

DROP TABLE babel_object_id_t1
GO
